<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#2563eb" />
<meta name="description" content="Flashcards Seznam - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —á–µ—à—Å–∫–∏—Ö —Å–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é –∫–∞—Ä—Ç–æ—á–µ–∫" />
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="manifest" href="/manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<title>Flashcards Seznam</title>

<style>
/* ===================================================================== */
/* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò - –ß–ò–°–¢–´–ô –ò –°–û–í–†–ï–ú–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù */
/* ===================================================================== */

:root {
  /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
  --primary: #2563eb;
  --primary-hover: #1d4ed8;
  --secondary: #64748b;
  --accent: #dc2626;
  --background: #f8fafc;
  --surface: #ffffff;
  --border: #e2e8f0;
  --text-primary: #0f172a;
  --text-secondary: #64748b;
  --text-muted: #94a3b8;
  --success: #16a34a;
  --warning: #d97706;
  --error: #dc2626;
  
  /* –†–∞–∑–º–µ—Ä—ã */
  --border-radius: 12px;
  --border-radius-sm: 8px;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --transition: all 0.2s ease;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--background);
  font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
}

.app {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  min-height: 100vh;
}

/* ===================================================================== */
/* –ó–ê–ì–û–õ–û–í–û–ö */
/* ===================================================================== */

.header {
  text-align: center;
  margin-bottom: 40px;
  padding: 30px 20px;
  background: var(--surface);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
}

.header h1 {
  color: var(--text-primary);
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 8px;
  letter-spacing: -0.025em;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 1.1rem;
  font-weight: 400;
}

/* ===================================================================== */
/* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
/* ===================================================================== */

.main-content {
  background: var(--surface);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  padding: 32px;
  min-height: 500px;
}

/* ===================================================================== */
/* –ö–ù–û–ü–ö–ò */
/* ===================================================================== */

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 500;
  text-align: center;
  transition: var(--transition);
  text-decoration: none;
  font-family: inherit;
  line-height: 1;
  min-height: 44px;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background-color: var(--primary);
  color: white;
  border: 1px solid var(--primary);
}

.btn-primary:hover:not(:disabled) {
  background-color: var(--primary-hover);
  border-color: var(--primary-hover);
}

.btn-secondary {
  background-color: var(--surface);
  color: var(--text-primary);
  border: 1px solid var(--border);
}

.btn-secondary:hover:not(:disabled) {
  background-color: var(--background);
  border-color: var(--secondary);
}

.actions {
  margin-top: 24px;
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
}

/* ===================================================================== */
/* –í–í–û–î –¢–ï–ö–°–¢–ê */
/* ===================================================================== */

.text-input {
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
}

.text-input h2 {
  text-align: center;
  margin-bottom: 12px;
  color: var(--text-primary);
  font-size: 1.5rem;
  font-weight: 600;
}

.instruction {
  text-align: center;
  margin-bottom: 24px;
  color: var(--text-secondary);
  font-size: 0.875rem;
  line-height: 1.5;
}

.text-area {
  width: 100%;
  min-height: 200px;
  padding: 16px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--border);
  font-family: inherit;
  font-size: 0.875rem;
  resize: vertical;
  transition: var(--transition);
  margin-bottom: 20px;
  background: var(--surface);
  color: var(--text-primary);
}

.text-area:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
}

.text-area::placeholder {
  color: var(--text-muted);
}

/* ===================================================================== */
/* –ò–ó–í–õ–ï–ß–ï–ù–ù–´–ï –°–õ–û–í–ê */
/* ===================================================================== */

.extracted-words {
  margin-bottom: 32px;
}

.extracted-words h2 {
  margin-bottom: 20px;
  text-align: center;
  color: var(--text-primary);
  font-size: 1.5rem;
  font-weight: 600;
}

.words-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 24px;
  justify-content: center;
}

.word-chip {
  background: var(--background);
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.875rem;
  border: 1px solid var(--border);
  color: var(--text-primary);
  transition: var(--transition);
  font-weight: 500;
}

.word-chip:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* ===================================================================== */
/* –ò–ù–î–ò–ö–ê–¢–û–† –ü–†–û–ì–†–ï–°–°–ê */
/* ===================================================================== */

.progress-container {
  margin: 24px auto;
  max-width: 400px;
}

.progress-bar {
  height: 8px;
  background: var(--background);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
  border: 1px solid var(--border);
}

.progress-bar-fill {
  height: 100%;
  background: var(--primary);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.progress-text {
  font-size: 0.75rem;
  color: var(--text-secondary);
  text-align: center;
  font-weight: 500;
}

/* ===================================================================== */
/* –°–û–û–ë–©–ï–ù–ò–Ø –û–ë –û–®–ò–ë–ö–ê–• */
/* ===================================================================== */

.error-message {
  color: var(--error);
  text-align: center;
  margin: 16px 0;
  padding: 12px 16px;
  border: 1px solid rgb(220 38 38 / 0.2);
  border-radius: var(--border-radius-sm);
  background: rgb(220 38 38 / 0.05);
  font-size: 0.875rem;
}

.no-cards {
  text-align: center;
  padding: 60px 20px;
  font-size: 1rem;
  color: var(--text-secondary);
}

/* ===================================================================== */
/* –ö–ê–†–¢–û–ß–ö–ò - –£–õ–£–ß–®–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù –ë–ï–ó –ì–†–ê–î–ò–ï–ù–¢–û–í */
/* ===================================================================== */

.flashcard-viewer {
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  padding: 20px 0;
}

.progress-info {
  text-align: center;
  margin-bottom: 24px;
  font-size: 0.875rem;
  color: var(--text-secondary);
  font-weight: 500;
  background: var(--background);
  padding: 8px 16px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--border);
  display: inline-block;
}

.card-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
  margin-bottom: 32px;
  min-height: 400px;
}

.nav-btn {
  background: var(--surface);
  border: 2px solid var(--border);
  color: var(--text-primary);
  font-size: 1.5rem;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
  font-weight: 600;
}

.nav-btn:hover {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
  box-shadow: var(--shadow);
}

.nav-btn:active {
  transform: scale(0.95);
}

.nav-btn:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgb(37 99 235 / 0.2);
}

/* ===================================================================== */
/* –ö–ê–†–¢–û–ß–ö–ê - –ß–ò–°–¢–´–ô –î–ò–ó–ê–ô–ù */
/* ===================================================================== */

.flashcard {
  perspective: 1000px;
  cursor: pointer;
  width: 100%;
  max-width: 420px;
  height: 360px;
  margin: 0 auto;
}

.card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.4s ease;
  transform-style: preserve-3d;
  border-radius: var(--border-radius);
}

.flashcard.flipped .card-inner {
  transform: rotateY(180deg);
}

.card-front,
.card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: var(--border-radius);
  border: 2px solid var(--border);
  background: var(--surface);
  box-shadow: var(--shadow-lg);
  display: flex;
  flex-direction: column;
  padding: 32px 24px;
}

/* –õ–ò–¶–ï–í–ê–Ø –°–¢–û–†–û–ù–ê - –ø—Ä–æ—Å—Ç–∞—è –∏ —á–∏—Å—Ç–∞—è */
.card-front {
  justify-content: center;
  align-items: center;
  text-align: center;
}

.word {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 16px;
  letter-spacing: -0.025em;
  line-height: 1.1;
  word-break: break-word;
}

.hint {
  font-size: 0.875rem;
  color: var(--text-muted);
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  font-weight: 400;
}

/* –û–ë–†–ê–¢–ù–ê–Ø –°–¢–û–†–û–ù–ê - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
.card-back {
  transform: rotateY(180deg);
  justify-content: flex-start;
  align-items: stretch;
  overflow-y: auto;
  padding: 24px;
}

.original-word {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
  word-break: break-word;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ */
.normalization-info {
  background: var(--background);
  border: 1px solid var(--border);
  border-radius: var(--border-radius-sm);
  padding: 12px 16px;
  margin-bottom: 20px;
  font-size: 0.75rem;
}

.normalization-info > div:first-child {
  color: var(--text-secondary);
  font-weight: 600;
  margin-bottom: 4px;
}

.normalization-info > div:nth-child(2) {
  color: var(--primary);
  font-weight: 700;
  font-size: 0.875rem;
}

.normalization-info > div:last-child {
  color: var(--text-muted);
  margin-top: 4px;
  font-style: italic;
}

/* –ü–µ—Ä–µ–≤–æ–¥—ã –∏ –ø—Ä–∏–º–µ—Ä—ã */
.translations,
.examples {
  margin-bottom: 20px;
}

.translations h4,
.examples h4 {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 12px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 6px;
}

.translations ul,
.examples ul {
  list-style: none;
  padding: 0;
}

.translations li {
  margin-bottom: 8px;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-primary);
  padding: 8px 12px;
  background: var(--background);
  border-radius: var(--border-radius-sm);
  border-left: 3px solid var(--primary);
}

.examples li {
  margin-bottom: 12px;
  background: var(--background);
  padding: 12px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--border);
}

.sample-phrase {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.875rem;
  margin-bottom: 6px;
  border-bottom: 1px dashed var(--border);
  padding-bottom: 4px;
}

.sample-translation {
  font-style: italic;
  color: var(--text-secondary);
  font-size: 0.875rem;
  line-height: 1.4;
}

.no-translations {
  color: var(--text-muted);
  text-align: center;
  font-style: italic;
  padding: 20px;
  font-size: 0.875rem;
}

.note {
  font-size: 0.75rem;
  font-style: italic;
  color: var(--text-secondary);
  margin-top: 12px;
  text-align: center;
  padding: 8px 12px;
  background: var(--background);
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--border);
}

.attribution {
  font-size: 0.625rem;
  color: var(--text-muted);
  position: absolute;
  bottom: 8px;
  right: 12px;
  font-style: italic;
}

/* ===================================================================== */
/* –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –ö–ê–†–¢–û–ß–ö–ê–ú */
/* ===================================================================== */

.card-progress {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 20px;
  padding: 0 20px;
}

.progress-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--border);
  border: 2px solid var(--border);
  cursor: pointer;
  transition: var(--transition);
}

.progress-dot:hover {
  background: var(--secondary);
  border-color: var(--secondary);
}

.progress-dot.active {
  background: var(--primary);
  border-color: var(--primary);
  transform: scale(1.2);
}

/* ===================================================================== */
/* –°–õ–û–í–ê–†–¨ */
/* ===================================================================== */

.dictionary-stats {
  margin-top: 32px;
  padding: 20px;
  background: var(--background);
  border-radius: var(--border-radius);
  text-align: center;
  border: 1px solid var(--border);
}

.dictionary-button {
  margin: 0 6px;
  padding: 8px 16px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  font-size: 0.75rem;
  font-weight: 500;
  transition: var(--transition);
}

.dictionary-button:hover {
  background: var(--primary-hover);
}

.dictionary-view {
  margin-top: 20px;
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid var(--border);
  border-radius: var(--border-radius-sm);
  padding: 16px;
  background: var(--surface);
}

.dict-word-item {
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.dict-word-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.dict-word {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.875rem;
}

.dict-translations {
  margin-top: 4px;
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.api-attribution {
  text-align: center;
  margin-top: 20px;
  font-size: 0.75rem;
  color: var(--text-muted);
}

.api-attribution a {
  color: var(--primary);
  text-decoration: none;
}

.api-attribution a:hover {
  text-decoration: underline;
}

/* ===================================================================== */
/* –ó–ê–ì–†–£–ó–ö–ê */
/* ===================================================================== */

.loading {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
  font-size: 0.875rem;
}

/* ===================================================================== */
/* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
/* ===================================================================== */

@media screen and (max-width: 768px) {
  .app {
    padding: 12px;
  }

  .header {
    padding: 24px 16px;
    margin-bottom: 24px;
  }

  .header h1 {
    font-size: 2rem;
  }

  .main-content {
    padding: 24px 16px;
  }

  .text-area {
    min-height: 150px;
  }

  .flashcard {
    max-width: 340px;
    height: 320px;
  }

  .word {
    font-size: 2rem;
  }

  .original-word {
    font-size: 1.25rem;
  }

  .card-container {
    gap: 16px;
    min-height: 340px;
  }

  .nav-btn {
    width: 44px;
    height: 44px;
    font-size: 1.25rem;
  }

  .card-front,
  .card-back {
    padding: 24px 20px;
  }

  .actions {
    flex-direction: column;
    align-items: center;
  }

  .btn {
    min-width: 200px;
  }
}

/* ===================================================================== */
/* –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */
/* ===================================================================== */

@media (prefers-color-scheme: dark) {
  :root {
    --primary: #3b82f6;
    --primary-hover: #2563eb;
    --secondary: #64748b;
    --accent: #ef4444;
    --background: #0f172a;
    --surface: #1e293b;
    --border: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #64748b;
    --success: #22c55e;
    --warning: #f59e0b;
    --error: #ef4444;
  }
}
</style>
</head>
<body>
<noscript>–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å JavaScript.</noscript>
<div id="root">
  <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
</div>

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<script type="module">
  // –ò–º–ø–æ—Ä—Ç Firebase SDK –∏–∑ CDN  
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js';
  import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js';

  // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  // –í–ê–ñ–ù–û: –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ API –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firebase.
  const firebaseConfig = {
    apiKey: "AIzaSyAPZIHxaLt92McIvbIcYE-tSYp2Li2jxs4", // –≠—Ç–æ—Ç –∫–ª—é—á –≤–∏–¥–µ–Ω –∫–ª–∏–µ–Ω—Ç—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∏ –ø—Ä–∞–≤–∏–ª–∞ Firebase Database/Firestore/Storage –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ.
    authDomain: "flashcards-seznam-6652a.firebaseapp.com",
    projectId: "flashcards-seznam-6652a",
    storageBucket: "flashcards-seznam-6652a.firebasestorage.app",
    messagingSenderId: "99460986155",
    appId: "1:99460986155:web:e5ca466e3d07c20cde016e",
    databaseURL: "https://flashcards-seznam-6652a-default-rtdb.europe-west1.firebasedatabase.app"
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
  let app, database;

  try {
    console.log('üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
    app = initializeApp(firebaseConfig);
    database = getDatabase(app);

    console.log('‚úÖ Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    const testRef = ref(database, 'test');
    get(testRef).then(() => {
      console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Firebase Database —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    }).catch((error) => {
      console.warn('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º Firebase Database:', error);
    });

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:', error);
    database = null; // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ database null –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
  }

  // –î–µ–ª–∞–µ–º Firebase –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (ES5)
  window.firebaseApp = app;
  window.firebaseDB = database;
  window.firebaseRef = ref;
  window.firebaseSet = set;
  window.firebaseGet = get;
</script>

<script>
// ===================================================================
// –û–°–ù–û–í–ù–û–ô –ö–û–î –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (ES5 –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
// ===================================================================

const { useState, useEffect, createElement: h } = React;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
const extractUniqueWords = function (text) {
  if (!text || typeof text !== 'string') {
    return [];
  }

  // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
  const preprocessedText = text
    .replace(/<[^>]*>/g, ' ') // –£–¥–∞–ª—è–µ–º HTML —Ç–µ–≥–∏
    .replace(/https?:\/\/[^\s]+/g, ' ') // –£–¥–∞–ª—è–µ–º URL
    .replace(/\S+@\S+\.\S+/g, ' ') // –£–¥–∞–ª—è–µ–º email
    .replace(/[""'']/g, '"') // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–∞–≤—ã—á–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π)
    .replace(/[‚Äì‚Äî]/g, '-') // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–∏—Ä–µ
    .replace(/\s+/g, ' ') // –ó–∞–º–µ–Ω—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –æ–¥–∏–Ω
    .trim();

  // –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
  const lowerCaseText = preprocessedText.toLowerCase();

  // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –∑–Ω–∞–∫–æ–≤ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –∏ —Ü–∏—Ñ—Ä
  // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ –ø—Ä–æ–±–µ–ª—ã, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è Unicode (–≤–∫–ª—é—á–∞—è —á–µ—à—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã)
  const cleanedText = lowerCaseText
    .replace(/[.,/#!$%^&*;:{}=\-_`~()¬´¬ª‚Äû""''\[\]?¬ø¬°!@#$%^&*+=|\\<>]/g, ' ') // –£–¥–∞–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é
    .replace(/\d+/g, ' ') // –£–¥–∞–ª—è–µ–º —Ü–∏—Ñ—Ä—ã
    .replace(/[^\p{L}\s]/gu, ' ') // –£–¥–∞–ª—è–µ–º –≤—Å–µ, —á—Ç–æ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –±—É–∫–≤–æ–π Unicode –∏–ª–∏ –ø—Ä–æ–±–µ–ª–æ–º
    .replace(/\s+/g, ' '); // –°–Ω–æ–≤–∞ —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

  // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–ª–æ–≤–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º
  const words = cleanedText
    .split(/\s+/)
    .filter(function (word) {
      return word.length > 1 && // –°–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –æ–¥–Ω–æ–π –±—É–∫–≤—ã
        isValidCzechWord(word); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —á–µ—à—Å–∫–∏–µ –±—É–∫–≤—ã
    });

  // –°–æ–∑–¥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
  const uniqueWordsSet = new Set(words);

  return Array.from(uniqueWordsSet).sort(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ–µ —á–µ—à—Å–∫–æ–µ —Å–ª–æ–≤–æ (—Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —á–µ—à—Å–∫–∏–µ –±—É–∫–≤—ã)
function isValidCzechWord(word) {
  if (!/\p{L}/u.test(word)) return false; // –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–∫–≤–∞
  // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–æ—Å—Ç–æ–∏—Ç –ª–∏ —Å–ª–æ–≤–æ —Ç–æ–ª—å–∫–æ –∏–∑ –±—É–∫–≤ —á–µ—à—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ (–≤–∫–ª—é—á–∞—è –¥–∏–∞–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–∫–∏)
  const czechLetters = /^[a-z√°ƒçƒè√©ƒõ√≠≈à√≥≈ô≈°≈•√∫≈Ø√Ω≈æ]+$/i;
  return czechLetters.test(word);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ Firebase
async function saveToCloudDictionary(wordData) {
  if (!window.firebaseDB) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    console.warn('‚ö†Ô∏è Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ');
    return false;
  }

  try {
    const wordKey = wordData.word.toLowerCase(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–æ–≤–æ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ –∫–∞–∫ –∫–ª—é—á
    const database = window.firebaseDB;
    const dbRef = window.firebaseRef; // –ü–æ–ª—É—á–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
    const dbSet = window.firebaseSet;
    const dbGet = window.firebaseGet;

    // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞
    try {
      const snapshot = await dbGet(dbRef(database, 'dictionary/' + wordKey));

      if (snapshot.exists()) {
        // –ï—Å–ª–∏ —Å–ª–æ–≤–æ —É–∂–µ –µ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
        const existingData = snapshot.val();

        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        const allTranslations = Array.from(new Set([].concat(
          existingData.translations || [],
          wordData.translations || []
        )));

        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä—ã, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø–æ –ø–∞—Ä–µ phrase|translation)
        const samplesMap = {}; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
        (existingData.samples || []).forEach(function (sample) {
          const key = sample.phrase + '|' + sample.translation;
          samplesMap[key] = sample;
        });
        (wordData.samples || []).forEach(function (sample) {
          const key = sample.phrase + '|' + sample.translation;
          samplesMap[key] = sample;
        });
        const allSamples = Object.values(samplesMap);

        const updatedData = Object.assign({}, existingData, {
          translations: allTranslations,
          samples: allSamples,
          lastUpdated: new Date().toISOString()
        });

        await dbSet(dbRef(database, 'dictionary/' + wordKey), updatedData);
      } else {
        // –ï—Å–ª–∏ —Å–ª–æ–≤–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
        await dbSet(dbRef(database, 'dictionary/' + wordKey), Object.assign({}, wordData, {
          created: new Date().toISOString(),
          lastUpdated: new Date().toISOString()
        }));
      }
    } catch (getError) {
      // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –ø—Ä–∞–≤–∏–ª),
      // –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø–∏—Å–∞—Ç—å (—ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å)
      // –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.
      console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é, –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å:', getError);
      await dbSet(dbRef(database, 'dictionary/' + wordKey), Object.assign({}, wordData, {
        created: new Date().toISOString(),
        lastUpdated: new Date().toISOString()
      }));
    }

    console.log('‚úÖ –°–ª–æ–≤–æ "' + wordData.word + '" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞—á–Ω–æ–º —Å–ª–æ–≤–∞—Ä–µ');
    return true;
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –æ–±–ª–∞—á–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å:', error);
    return false;
  }
}


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∏–∑ Firebase
async function getFromCloudDictionary(word) {
  if (!word || !window.firebaseDB) return null;

  try {
    const wordKey = word.toLowerCase();
    const database = window.firebaseDB;
    const dbRef = window.firebaseRef;
    const dbGet = window.firebaseGet;

    const snapshot = await dbGet(dbRef(database, 'dictionary/' + wordKey));

    if (snapshot.exists()) {
      console.log('‚úÖ –°–ª–æ–≤–æ "' + word + '" –Ω–∞–π–¥–µ–Ω–æ –≤ –æ–±–ª–∞—á–Ω–æ–º —Å–ª–æ–≤–∞—Ä–µ');
      return snapshot.val();
    } else {
      console.log('‚ÑπÔ∏è –°–ª–æ–≤–æ "' + word + '" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –æ–±–ª–∞—á–Ω–æ–º —Å–ª–æ–≤–∞—Ä–µ');
      return null;
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–∑ –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è:', error);
    return null;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è
async function getEntireDictionary() {
  if (!window.firebaseDB) {
    console.warn('‚ö†Ô∏è Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    return [];
  }

  try {
    const database = window.firebaseDB;
    const dbRef = window.firebaseRef;
    const dbGet = window.firebaseGet;

    const snapshot = await dbGet(dbRef(database, 'dictionary'));

    if (snapshot.exists()) {
      const dictionary = snapshot.val();
      return Object.values(dictionary); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π
    } else {
      console.log('‚ÑπÔ∏è –°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç');
      return [];
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ª–æ–≤–∞—Ä—è:', error);
    return [];
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–ª–æ–≤–∞—Ä—è –≤ JSON
function exportDictionaryToJson(dictionary) {
  try {
    const dataStr = JSON.stringify(dictionary, null, 2); // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

    const exportFileDefaultName = 'czech_dictionary.json';

    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click(); // –ò–Ω–∏—Ü–∏–∏—Ä—É–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Å–ª–æ–≤–∞—Ä—è:', error);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Å–ª–æ–≤–∞—Ä—è: ' + error.message);
  }
}


// ===================================================================
// –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–í–û–î–ê –° –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–ï–ô (–ó–ê–ì–õ–£–®–ö–ê)
// ===================================================================

// –í–ê–ñ–ù–û: –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ glosbeTranslator.js
window.fetchTranslation = async function(word) {
  console.log('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ (–∑–∞–≥–ª—É—à–∫–∞). –û–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã...');
  
  // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
  // –ü–æ–ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å, –µ—Å–ª–∏ –µ—Å—Ç—å
  const basicTranslations = getBasicTranslation(word);

  return {
    word: word,
    translations: basicTranslations || [],
    samples: [], // –ë–∞–∑–æ–≤–∞—è –∑–∞–≥–ª—É—à–∫–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä—ã
    note: basicTranslations ? '–ü–µ—Ä–µ–≤–æ–¥ –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è.' : '–°–∏—Å—Ç–µ–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...',
    timestamp: new Date().toISOString()
  };
};

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –±–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è fallback
function getBasicTranslation(word) {
  const basicDict = {
    // –ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è
    'n√°≈°': ['–Ω–∞—à', '–Ω–∞—à–∞', '–Ω–∞—à–µ'],
    'v√°≈°': ['–≤–∞—à', '–≤–∞—à–∞', '–≤–∞—à–µ'],
    'm≈Øj': ['–º–æ–π', '–º–æ—è', '–º–æ—ë'],
    'tv≈Øj': ['—Ç–≤–æ–π', '—Ç–≤–æ—è', '—Ç–≤–æ—ë'],
    'ten': ['—Ç–æ—Ç', '—ç—Ç–æ—Ç'],
    'tento': ['—ç—Ç–æ—Ç'],
    'on': ['–æ–Ω'],
    'ona': ['–æ–Ω–∞'],
    'my': ['–º—ã'],
    'vy': ['–≤—ã'],
    'oni': ['–æ–Ω–∏'],

    // –ß–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ
    'jeden': ['–æ–¥–∏–Ω'], 'dva': ['–¥–≤–∞'], 't≈ôi': ['—Ç—Ä–∏'], 'ƒçty≈ôi': ['—á–µ—Ç—ã—Ä–µ'], 'pƒõt': ['–ø—è—Ç—å'],

    // –ì–ª–∞–≥–æ–ª—ã
    'doporuƒçovat': ['—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å'], 'b√Ωt': ['–±—ã—Ç—å'], 'm√≠t': ['–∏–º–µ—Ç—å'], 'dƒõlat': ['–¥–µ–ª–∞—Ç—å'],
    'j√≠t': ['–∏–¥—Ç–∏'], 'prosit': ['–ø—Ä–æ—Å–∏—Ç—å'], 'kl√°st': ['–∫–ª–∞—Å—Ç—å'],

    // –°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ
    'dotaz': ['–≤–æ–ø—Ä–æ—Å'], 'z√°kazn√≠k': ['–∫–ª–∏–µ–Ω—Ç'], 'seri√°l': ['—Å–µ—Ä–∏–∞–ª'],

    // –ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ
    'dobr√Ω': ['—Ö–æ—Ä–æ—à–∏–π'], 'skvƒõl√Ω': ['–æ—Ç–ª–∏—á–Ω—ã–π', '–≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã–π'],

    // –ù–∞—Ä–µ—á–∏—è
    'tak√©': ['—Ç–∞–∫–∂–µ'], 'samoz≈ôejmƒõ': ['–∫–æ–Ω–µ—á–Ω–æ']
    // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –±–∞–∑–æ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  };

  return basicDict[word.toLowerCase()] || null;
}

// ===================================================================
// –ö–û–ú–ü–û–ù–ï–ù–¢–´ REACT
// ===================================================================

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–ª–æ–≤–∞—Ä—è
const DictionaryStats = function (props) {
  const onViewDictionary = props.onViewDictionary;
  const [wordCount, setWordCount] = useState(0); // –ò—Å–ø–æ–ª—å–∑—É–µ–º React.useState

  useEffect(function () {
    async function loadStats() {
      try {
        const dictionary = await getEntireDictionary();
        setWordCount(dictionary.length);
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–ª–æ–≤–∞—Ä—è:', error);
      }
    }

    loadStats();
  }, []); // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - –∑–∞–ø—É—Å–∫ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

  const handleExportDictionary = async function () {
    try {
      const dictionary = await getEntireDictionary();
      if (dictionary.length > 0) {
        exportDictionaryToJson(dictionary);
      } else {
        alert('–°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç. –ù–µ—á–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å.');
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Å–ª–æ–≤–∞—Ä—è:', error);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Å–ª–æ–≤–∞—Ä—è.');
    }
  };

  return h('div', { className: 'dictionary-stats' },
    h('p', null, '–í –≤–∞—à–µ–º –æ–±–ª–∞—á–Ω–æ–º —Å–ª–æ–≤–∞—Ä–µ: ', h('strong', null, wordCount), ' —Å–ª–æ–≤'),
    h('div', { style: { marginTop: '10px' } },
      h('button', { className: 'dictionary-button', onClick: onViewDictionary }, '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–æ–≤–∞—Ä—å'),
      h('button', { className: 'dictionary-button', onClick: handleExportDictionary }, '–≠–∫—Å–ø–æ—Ä—Ç —Å–ª–æ–≤–∞—Ä—è')
    )
  );
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ª–æ–≤–∞—Ä—è
const DictionaryViewer = function (props) {
  const onClose = props.onClose;
  const [dictionary, setDictionary] = useState([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(function () {
    async function loadDictionary() {
      setIsLoading(true);
      try {
        const dict = await getEntireDictionary();
        dict.sort(function (a, b) { return a.word.localeCompare(b.word); }); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–ª–æ–≤—É
        setDictionary(dict);
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ª–æ–≤–∞—Ä—è:', error);
      } finally {
        setIsLoading(false);
      }
    }

    loadDictionary();
  }, []);

  if (isLoading) {
    return h('div', { className: 'dictionary-view' }, '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä—è...');
  }

  if (dictionary.length === 0) {
    return h('div', { className: 'dictionary-view' },
      h('p', null, '–°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞.'),
      h('button', { className: 'btn btn-secondary', onClick: onClose, style: { marginTop: '15px' } }, '–ó–∞–∫—Ä—ã—Ç—å')
    );
  }

  return h('div', null, // –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è DictionaryViewer –∏ –∫–Ω–æ–ø–∫–∏ "–ó–∞–∫—Ä—ã—Ç—å"
    h('div', { className: 'dictionary-view' },
      dictionary.map(function (entry, index) {
        return h('div', { key: entry.word || index, className: 'dict-word-item' }, // –ò—Å–ø–æ–ª—å–∑—É–µ–º entry.word –∫–∞–∫ –∫–ª—é—á, –µ—Å–ª–∏ –æ–Ω —É–Ω–∏–∫–∞–ª–µ–Ω, –∏–Ω–∞—á–µ index
          h('div', { className: 'dict-word' }, entry.word),
          h('div', { className: 'dict-translations' }, (entry.translations || []).join(', ')) // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ undefined
        );
      })
    ),
    h('button', { className: 'btn btn-secondary', onClick: onClose, style: { marginTop: '15px', display: 'block', marginLeft: 'auto', marginRight: 'auto' } }, '–ó–∞–∫—Ä—ã—Ç—å')
  );
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
const TextInput = function (props) {
  const text = props.text;
  const onTextChange = props.onTextChange;
  const onExtractWords = props.onExtractWords;

  return h('div', { className: 'text-input' },
    h('h2', null, '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ —á–µ—à—Å–∫–æ–º —è–∑—ã–∫–µ'),
    h('p', { className: 'instruction' },
      '–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç (—Å—Ç–∞—Ç—å—é, —Ä–∞—Å—Å–∫–∞–∑, –¥–∏–∞–ª–æ–≥) –Ω–∞ —á–µ—à—Å–∫–æ–º —è–∑—ã–∫–µ, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å —Å–ª–æ–≤–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è.'
    ),
    h('textarea', {
      className: 'text-area',
      value: text,
      onChange: function (e) { onTextChange(e.target.value); },
      placeholder: '–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ —á–µ—à—Å–∫–æ–º —è–∑—ã–∫–µ...',
      rows: 10
    }),
    h('button', {
      className: 'btn btn-primary',
      onClick: onExtractWords,
      disabled: !text.trim(), // –ö–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—É—Å—Ç –∏–ª–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤
      style: { display: 'block', margin: '0 auto' } // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    }, '–ò–∑–≤–ª–µ—á—å —Å–ª–æ–≤–∞')
  );
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
const ProgressIndicator = function (props) {
  const progress = props.progress;

  return h('div', { className: 'progress-container' },
    h('div', { className: 'progress-bar' },
      h('div', {
        className: 'progress-bar-fill',
        style: { width: progress + '%' }
      })
    ),
    h('div', { className: 'progress-text' }, progress + '% –∑–∞–≤–µ—Ä—à–µ–Ω–æ')
  );
};

// –£–õ–£–ß–®–ï–ù–ù–´–ô –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø–æ–∫–∞–∑–æ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
const Flashcard = function (props) {
  const word = props.word;
  const translations = props.translations || []; // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  const samples = props.samples || [];
  const note = props.note;
  const normalizedWord = props.normalizedWord;
  const normalizedVariants = props.normalizedVariants;
  const usedNormalization = props.usedNormalization;

  const [isFlipped, setIsFlipped] = useState(false);

  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ flipped –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–ª–æ–≤–∞
  useEffect(function() {
    setIsFlipped(false);
  }, [word]);


  const handleFlip = function () {
    setIsFlipped(!isFlipped);
  };

  return h('div', {
    className: 'flashcard' + (isFlipped ? ' flipped' : ''),
    onClick: handleFlip
  },
    h('div', { className: 'card-inner' },
      h('div', { className: 'card-front' },
        h('div', { className: 'word' }, word),
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∏ —Å–ª–æ–≤–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
        usedNormalization && normalizedWord && normalizedWord !== word && h('div', {
          style: {
            fontSize: '0.75rem',
            opacity: '0.7',
            marginTop: '8px',
            fontStyle: 'italic',
            color: 'var(--text-muted)'
          }
        }, '‚Üí ' + normalizedWord),
        h('p', { className: 'hint' }, '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–µ—Ä–µ–≤–æ–¥')
      ),
      h('div', { className: 'card-back' },
        h('h3', { className: 'original-word' }, word),

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
        usedNormalization && normalizedWord && normalizedWord !== word && h('div', { className: 'normalization-info' },
          h('div', null, 'üîÑ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ:'),
          h('div', null, normalizedWord),
          normalizedVariants && normalizedVariants.length > 0 && h('div', null, // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ normalizedVariants –∏ –¥–ª–∏–Ω—É
            '–í–∞—Ä–∏–∞–Ω—Ç—ã: ' + normalizedVariants.slice(1).join(', ') // –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - —Å–∞–º–æ —Å–ª–æ–≤–æ, –º–æ–∂–Ω–æ –µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ
          )
        ),

        h('div', { className: 'translations' },
          translations && translations.length > 0 ?
            h('div', null,
              h('h4', null, '–ü–µ—Ä–µ–≤–æ–¥—ã:'),
              h('ul', null,
                translations.map(function (translation, index) {
                  return h('li', { key: index }, translation);
                })
              )
            ) :
            h('p', { className: 'no-translations' }, '–ü–µ—Ä–µ–≤–æ–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã')
        ),

        samples && samples.length > 0 && h('div', { className: 'examples' },
          h('h4', null, '–ü—Ä–∏–º–µ—Ä—ã' + (usedNormalization && normalizedWord && normalizedWord !== word ? ' (–¥–ª—è ' + normalizedWord + '):' : ':')),
          h('ul', null,
            samples.map(function (sample, index) {
              return h('li', { key: index },
                h('div', { className: 'sample-phrase' }, sample.phrase),
                h('div', { className: 'sample-translation' }, sample.translation)
              );
            })
          )
        ),

        note && h('p', { className: 'note' }, note),

        h('p', { className: 'hint' }, '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ª–æ–≤—É'),

        h('div', { className: 'attribution' },
          '–ò—Å—Ç–æ—á–Ω–∏–∫: Glosbe' +
          (usedNormalization && normalizedWord && normalizedWord !== word ? ' (—á–µ—Ä–µ–∑ ' + normalizedWord + ')' : '')
        )
      )
    )
  );
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
const FlashcardViewer = function (props) {
  const flashcards = props.flashcards;
  const [currentIndex, setCurrentIndex] = useState(0);

  // –°–±—Ä–æ—Å currentIndex –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞–±–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç)
  // –∏–ª–∏ –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å —Å—Ç–∞–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º.
  useEffect(function() {
    if (flashcards && flashcards.length > 0) {
        if (currentIndex >= flashcards.length) {
            setCurrentIndex(0); // –°–±—Ä–æ—Å –Ω–∞ –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
        }
    } else {
        setCurrentIndex(0); // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–µ—Ç, —Å—Ç–∞–≤–∏–º 0
    }
  }, [flashcards, currentIndex]); // –°–ª–µ–¥–∏–º –∑–∞ flashcards –∏ currentIndex


  if (!flashcards || flashcards.length === 0) {
    return h('div', { className: 'no-cards' }, '–ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.');
  }

  const currentCard = flashcards[currentIndex];
  if (!currentCard) { // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
      return h('div', { className: 'no-cards' }, '–û—à–∏–±–∫–∞: —Ç–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.');
  }


  const goToPrevious = function () {
    setCurrentIndex(function (prevIndex) {
      return prevIndex === 0 ? flashcards.length - 1 : prevIndex - 1;
    });
  };

  const goToNext = function () {
    setCurrentIndex(function (prevIndex) {
      return prevIndex === flashcards.length - 1 ? 0 : prevIndex + 1;
    });
  };

  return h('div', { className: 'flashcard-viewer' },
    h('div', { className: 'progress-info' },
      '–ö–∞—Ä—Ç–æ—á–∫–∞ ' + (currentIndex + 1) + ' –∏–∑ ' + flashcards.length
    ),
    h('div', { className: 'card-container' },
      h('button', {
        className: 'nav-btn prev-btn',
        onClick: goToPrevious,
        'aria-label': '–ü—Ä–µ–¥—ã–¥—É—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞',
        disabled: flashcards.length <= 1 // –û—Ç–∫–ª—é—á–∏—Ç—å, –µ—Å–ª–∏ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞
      }, '‚Äπ'),

      h(Flashcard, { // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        key: currentCard.word + currentIndex, // –î–æ–±–∞–≤–ª—è–µ–º currentIndex –∫ –∫–ª—é—á—É –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞ Flashcard –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        word: currentCard.word,
        translations: currentCard.translations,
        samples: currentCard.samples,
        note: currentCard.note,
        normalizedWord: currentCard.normalizedWord,
        normalizedVariants: currentCard.normalizedVariants,
        usedNormalization: currentCard.usedNormalization
      }),

      h('button', {
        className: 'nav-btn next-btn',
        onClick: goToNext,
        'aria-label': '–°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞',
        disabled: flashcards.length <= 1 // –û—Ç–∫–ª—é—á–∏—Ç—å, –µ—Å–ª–∏ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞
      }, '‚Ä∫')
    ),
    h('div', { className: 'card-progress' },
      flashcards.map(function (_, index) {
        return h('span', {
          key: index,
          className: 'progress-dot' + (index === currentIndex ? ' active' : ''),
          onClick: function () { setCurrentIndex(index); }
        });
      })
    )
  );
};

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const App = function () {
  const [text, setText] = useState('');
  const [uniqueWords, setUniqueWords] = useState([]);
  const [flashcards, setFlashcards] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [currentStep, setCurrentStep] = useState('input'); // 'input', 'extracted', 'translated', 'dictionary'
  const [progress, setProgress] = useState(0);
  const [error, setError] = useState('');

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
  const handleTextChange = function (newText) {
    setText(newText);
  };

  // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
  const handleExtractWords = function () {
    if (!text.trim()) return;

    const words = extractUniqueWords(text);
    setUniqueWords(words);
    setCurrentStep('extracted');
    setFlashcards([]); // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    setError('');
  };

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
  const handleGetTranslations = async function () {
    if (uniqueWords.length === 0) return;

    setIsLoading(true);
    setProgress(0);
    setError('');
    setFlashcards([]); // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

    try {
      const translatedCards = [];
      let completed = 0;
      const total = uniqueWords.length;

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ 2 —Å–ª–æ–≤–∞ –∑–∞ —Ä–∞–∑ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
      // –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±—Ö–æ–¥–∞ –ª–∏–º–∏—Ç–æ–≤ API –∏–ª–∏ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
      const batchSize = 2;
      const delayBetweenBatches = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞

      for (let i = 0; i < total; i += batchSize) {
        const batch = uniqueWords.slice(i, i + batchSize);
        const batchPromises = batch.map(async function (word) {
          // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è
          let data = await getFromCloudDictionary(word);
          if (!data) { // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –æ–±–ª–∞–∫–µ, –ø–æ–ª—É—á–∞–µ–º —á–µ—Ä–µ–∑ API
            data = await window.fetchTranslation(word); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            if (data && (data.translations && data.translations.length > 0)) { // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã
              await saveToCloudDictionary(data);
            }
          }
          return data; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–∏–∑ –æ–±–ª–∞–∫–∞ –∏–ª–∏ API)
        });

        try {
          const batchResults = await Promise.all(batchPromises);

          batchResults.forEach(function (result) {
            if (result) { // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å—Ç—å
              translatedCards.push(result);
            }
          });
        } catch (batchError) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–∞–∫–µ—Ç–∞ —Å–ª–æ–≤:', batchError);
          // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞
        }

        completed += batch.length;
        setProgress(Math.min(100, Math.floor((completed / total) * 100))); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 100%

        // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–∞–∫–µ—Ç
        if (i + batchSize < total) {
          await new Promise(function (resolve) {
            setTimeout(resolve, delayBetweenBatches);
          });
        }
      }

      if (translatedCards.length === 0) {
        setError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—Å—Ç.');
      } else {
        setFlashcards(translatedCards.filter(card => card)); // –§–∏–ª—å—Ç—Ä—É–µ–º null/undefined –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
        setCurrentStep('translated');
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤:', error);
      setError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    } finally {
      setIsLoading(false);
      // setProgress(100); // –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ 100, –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∏ –æ—à–∏–±–∫–∏, –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
    }
  };

  // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  const handleReset = function () {
    setText('');
    setUniqueWords([]);
    setFlashcards([]);
    setCurrentStep('input');
    setProgress(0);
    setError('');
  };

  // –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ–≤–∞—Ä—è
  const handleViewDictionary = function () {
    setCurrentStep('dictionary');
  };

  // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ª–æ–≤–∞—Ä—è
  const handleCloseDictionary = function () {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —à–∞–≥—É –∏–ª–∏ –∫ –≤–≤–æ–¥—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if (flashcards.length > 0) {
      setCurrentStep('translated');
    } else if (uniqueWords.length > 0) {
      setCurrentStep('extracted');
    } else {
      setCurrentStep('input');
    }
  };

  return h('div', { className: 'app' },
    h('header', { className: 'header' },
      h('h1', null, 'Flashcards Seznam'),
      h('p', { className: 'subtitle' }, '–ò–∑—É—á–µ–Ω–∏–µ —á–µ—à—Å–∫–∏—Ö —Å–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é –∫–∞—Ä—Ç–æ—á–µ–∫')
    ),
    h('main', { className: 'main-content' },
      currentStep === 'input' && h(React.Fragment, null,
        h(TextInput, {
          text: text,
          onTextChange: handleTextChange,
          onExtractWords: handleExtractWords
        }),
        h(DictionaryStats, { onViewDictionary: handleViewDictionary })
      ),
      currentStep === 'extracted' && h('div', { className: 'extracted-words' },
        h('h2', null, '–ù–∞–π–¥–µ–Ω–æ ' + uniqueWords.length + ' —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤' + (uniqueWords.length > 0 ? ':' : '.')),
        uniqueWords.length > 0 && h('div', { className: 'words-container' },
          uniqueWords.map(function (word, index) {
            return h('span', { key: index, className: 'word-chip' }, word);
          })
        ),
        h('div', { className: 'actions' },
          h('button', {
            className: 'btn btn-primary',
            onClick: handleGetTranslations,
            disabled: isLoading || uniqueWords.length === 0 // –¢–∞–∫–∂–µ –æ—Ç–∫–ª—é—á–∞–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç —Å–ª–æ–≤
          }, isLoading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã'),
          h('button', { className: 'btn btn-secondary', onClick: handleReset }, '–°–±—Ä–æ—Å–∏—Ç—å')
        ),
        isLoading && h(ProgressIndicator, { progress: progress }),
        error && h('div', { className: 'error-message' }, error)
      ),
      currentStep === 'translated' && h('div', null,
        flashcards.length > 0 ?
            h(FlashcardViewer, { flashcards: flashcards }) :
            h('div', { className: 'no-cards' }, '–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã.'),
        h('div', { className: 'actions' },
          h('button', { className: 'btn btn-secondary', onClick: handleReset }, '–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ'),
          h('button', { className: 'btn btn-primary', onClick: handleViewDictionary }, '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ª–æ–≤–∞—Ä—å')
        ),
        h('div', { className: 'api-attribution' },
          '–ü–µ—Ä–µ–≤–æ–¥—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ª–æ–≤–∞—Ä–µ–º ',
          h('a', { href: 'https://glosbe.com', target: '_blank', rel: 'noopener noreferrer' }, 'Glosbe'),
          ' –∏ –≤–∞—à–∏–º –æ–±–ª–∞—á–Ω—ã–º —Å–ª–æ–≤–∞—Ä–µ–º.'
        )
      ),
      currentStep === 'dictionary' && h(DictionaryViewer, { onClose: handleCloseDictionary })
    )
  );
};

// ===================================================================
// –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ===================================================================

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function () {
    const rootElement = document.getElementById('root');
    if (rootElement) {
      const root = ReactDOM.createRoot(rootElement);
      root.render(h(App));
    } else {
      console.error("–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç —Å id 'root' –Ω–µ –Ω–∞–π–¥–µ–Ω.");
    }
  });
} else {
  const rootElement = document.getElementById('root');
  if (rootElement) {
    const root = ReactDOM.createRoot(rootElement);
    root.render(h(App));
  } else {
    console.error("–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç —Å id 'root' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤–æ –≤—Ä–µ–º—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.");
  }
}

// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã
console.log('üöÄ === FLASHCARDS SEZNAM ===');
console.log('‚úÖ –ë–∞–∑–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞...');
console.log('üìö –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ glosbeTranslator.js –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å');

</script>

<script type="module">
  // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥–∞
  try {
    // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å './src/glosbeTranslator.js' –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–≥–æ HTML —Ñ–∞–π–ª–∞.
    // –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –∏–º–µ–Ω–µ–º fetchTranslation.
    // –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ glosbeTranslator.js:
    // export async function fetchTranslation(word) { /* ... –ª–æ–≥–∏–∫–∞ ... */ return { word, translations: [...], ... }; }
    const glosbeModule = await import('./glosbeTranslator.js'); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ–¥—É–ª—å
    
    if (glosbeModule && typeof glosbeModule.fetchTranslation === 'function') {
      // –ó–∞–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ –ø–æ–ª–Ω—É—é
      window.fetchTranslation = glosbeModule.fetchTranslation;
      
      console.log('‚úÖ –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥–∞ (glosbeTranslator.js) –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!');
      console.log('üéØ –ü–æ–∫—Ä—ã—Ç–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ glosbeTranslator.js');
    } else {
      console.warn('‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ glosbeTranslator.js –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é fetchTranslation.');
      console.log('‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ (–∑–∞–≥–ª—É—à–∫–∞).');
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥–∞ (glosbeTranslator.js):', error);
    console.log('‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ (–∑–∞–≥–ª—É—à–∫–∞). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª ./src/glosbeTranslator.js —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫.');
  }
</script>
</body>
</html>